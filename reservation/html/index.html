<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>預約掛號首頁index</title>
    <link rel="stylesheet" href="/common/sass/common.css" />
    <link rel="stylesheet" href="/reservation/scss/reservation.css" />
  </head>

  <body>
    <div  id="container-bg"  class=" border p-0">
      <header class="header"></header>

      <div id="index-search-container">
        <section class="ad-loop">ad廣告輪播</section>
          <div class="majorTitle">預約掛號</div>
          <div class="card">
            <div class="cardItem">
              <div class="minTitle">搜尋關鍵字</div>
              <div class="input-container">
                <input 
                  type="text "
                  placeholder="關鍵字搜尋..."
                  class="form-control keyword"
                />
                <span class="cancelIcon">x</span>
              </div>
            </div>
            <div class="cardItem">
              <div class="minTitle borderBottom">選擇城市</div>
              <div class="cardItem-container city-container">
                <div class="list-singleLine">
                  <div class="listItem listItem-zone">北部</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city active">基隆市</div>
                </div>
                <div class="list-singleLine">
                  <div class="listItem listItem-zone">北部</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city active">基隆市</div>
                </div>
              </div>
            </div>

            <div id="district" class="cardItem">
              <div class="minTitle borderBottom">
                選擇區域(可複選)
                <div class="unlimited_btn district active" onclick="optionSelect('district','reset')">不限</div>
              </div>
              <div class="cardItem-container district-container">
                <div class="list-singleLine">
                  <div class="listItem listItem-zone">北部</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city active">基隆市</div>
                </div>
              </div>
            </div>

            <div id="department" class="cardItem">
              <div class="minTitle borderBottom">
                選擇科別(可複選)
                <div class="unlimited_btn department active"  onclick="optionSelect('department','reset')">不限</div>
              </div>
              <div class="cardItem-container department-container">
                <div class="list-singleLine">
                  <div class="listItem listItem-zone">北部</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city active">基隆市</div>
                </div>
              </div>
            </div>

            <div id="condition" class="cardItem">
              <div class="minTitle borderBottom">
                更多條件(可複選)
                <div class="unlimited_btn condition active"  onclick="optionSelect('condition','reset')">不限</div>
              </div>
              <div class="cardItem-container condition-container">
                <div class="list-singleLine">
                  <div class="listItem listItem-zone">北部</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city">基隆市</div>
                  <div class="listItem listItem-city active">基隆市</div>
                </div>
              </div>
            </div>
            <button class="btn btn-success">搜尋</button>
          </div>
        <section class="searchResult">
          <div class="majorTitle">搜尋結果</div>
          <div class="card">
            <div class="total">共38間診所</div>
            <div class="clinicList">
              <div class="clinicItem">
                <div class="departmentList">
                  <div class="departmentItem department">家醫科</div>
                  <div class="departmentItem department">家醫科</div>
                  <div class="departmentItem department">家醫科</div>
                </div>
                <div class="inform">
                  <div class="informItem name">丁文內科診所</div>
                  <div class="informItem tel">02-12345678</div>
                  <div class="informItem address">新北市蘆洲區長安街23號</div>
                  <div class="informItem btn btn-detail">詳細內容</div>
                </div>
              </div>

              <div class="clinicItem">
                <div class="departmentList">
                  <div class="departmentItem department">家醫科</div>
                  <div class="departmentItem department">家醫科</div>
                  <div class="departmentItem department">家醫科</div>
                </div>
                <div class="inform">
                  <div class="informItem name">丁文內科診所</div>
                  <div class="informItem tel">02-12345678</div>
                  <div class="informItem address">新北市蘆洲區長安街23號</div>
                  <div class="informItem btn btn-detail">詳細內容</div>
                </div>
              </div>
              <div class="clinicItem">
                <div class="departmentList">
                  <div class="departmentItem department">家醫科</div>
                  <div class="departmentItem department">家醫科</div>
                  <div class="departmentItem department">家醫科</div>
                </div>
                <div class="inform">
                  <div class="informItem name">丁文內科診所</div>
                  <div class="informItem tel">02-12345678</div>
                  <div class="informItem address">新北市蘆洲區長安街23號</div>
                  <div class="informItem btn btn-detail">詳細內容</div>
                </div>
              </div>
            </div>
            <section id="pagination" class="pagination">
              <ul class="page"></ul>
            </section>
          </div>
        </section>
      </div>

      <footer></footer>
    </div>
  </body>
</html>
<!-- <script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script> -->
<!-- <script src="../../js/innerHeight.js"></script> -->
<!-- <script src="../../js/cityZoneSelect.js"></script> -->
<!-- <script src="../../component/Header.js"></script> -->
<!-- <script src="../../component/Navbar.js"></script>
<script src="../../component/Carousel.js"></script>
<script src="../../component/HashTagContainer.js"></script>
<script src="../../component/Title-line.js"></script> -->
<!-- <script src="../../component/Footer.js"></script> -->

<!-- <script type="module" src="/js/UI_render.js"></script>
<script src="../../AreaManager.js"></script>
<script src="/js/class/INPUT.js"></script>
<script src="/js/class/PAGINATION.js"></script>
<script src="/js/class/RESERVATION_SEARCH.js"></script> -->

<script type="module" src="/common/js/Common_UI_Render.js"></script>
<script src="/reservation/js/class/AREAMANAGER.js"></script>
<script src="/reservation/js/class/PAGINATION.js"></script>
<script src="/reservation/js/class/RESERVATIONFILTER.js"></script>
<script>
  // page
  let page=new PAGINATION(5)
  let reservationFilter=new RESERVATIONFILTER()
</script>
<script>
    let dataOBJ = {
    keyword: "",
    city: "臺北市",
    district: [],
    department: [],
    condition: [],
  };
  // areaManager
  let manager = new AREAMANAGER();
  manager
    .onAreaChange((initial, items) => {

    })
    .onCityChange((initial, items) => {
    })
    .onDistrictChange((initial, items) => {
      districtUIRender(initial,items)
    })
    .start();


    const initCityUIRender = () => {
    let dom = document.querySelector(".cardItem-container.city-container");
    let str = "";
    // console.log(reservationFilter.city,"reservationFilter")
    const entries = Object.entries(manager.data);
    for (let i = 0; i < entries.length; i++) {
      const zone = entries[i];
      const city = Object.keys(zone[1]);
      str += ` <div class="list-singleLine">
                <div class="listItem listItem-zone">${zone[0]}</div>
                 ${city
                   .map(
                     (item, index) =>
                       `<div data-id="${item}" onclick="cityChange('${ zone[0]}','${item}')" 
                       class=" listItem listItem-city ${reservationFilter.city===item ? 'active': ''}">${item}</div>`
                   ).join("")}
                </div>`;
    }
    // ${searchObj.city === item ? "active" : ""}
    dom.innerHTML = str;
  };
  initCityUIRender();

  const cityChange = (zone, city) => {
    let target = event.target; //自己
    manager.selectArea(zone);
    manager.selectCity(city);
    let oldDom=document.querySelector(".cardItem-container.city-container .active")
    if (oldDom===target) {
      return
    }
    oldDom.classList.remove("active")
    target.classList.add("active")
    reservationFilter.onCityChange(city)
  };
  function districtUIRender(initial,items){
    items = items.slice(1);
    let dom=document.querySelector("#district")
    let listDom=dom.querySelector(".list-singleLine")
    let unlimitedDom=dom.querySelector(".unlimited_btn")

    unlimitedControl(unlimitedDom,initial)
    listRender(listDom,items,'district')
  }
  function listRender(dom,arr,type) {
    console.log(type,"tpye")
    let str=""
    for (let i = 0; i < arr.length; i++) {
      const e = arr[i];
      str+=`<div data-id=${e.code} class="listItem listItem-district" onClick=optionSelect('${type}')>${e.text}</div>`
    }
    dom.innerHTML=str
  }
function unlimitedControl(dom,initial) {
  if (initial==="不分區" || initial===[]) {
    dom.classList.add("active")
    return
  }
dom.classList.remove(".active")
  
}
function optionSelect(params,state=null) {
  let e=event.target
  if (state==="reset") {
    reservationFilter.onReset(params)
    return
  }
  let obj={
    id:e.getAttribute("data-id"),
    text:e.innerHTML
  }
  // console.log(obj,"event")
  if (params==="district") {
    reservationFilter.onDistrictChange(obj,params)
  }else if (params==="department") {
    reservationFilter.onDepartmentChange(obj,params)
  }else{
    // condition
    reservationFilter.onConditionChange(obj,params)
  }

}
function departmentRender(initial,items){
    // items = items.slice(1);
    let dom=document.querySelector("#department")
    let listDom=dom.querySelector(".list-singleLine")
    let unlimitedDom=dom.querySelector(".unlimited_btn")

    unlimitedControl(unlimitedDom,initial)
    listRender(listDom,items,'department')
  }
let departmentArr=[{code:1,text:"123"},{code:2,text:"2"},{code:3,text:"3"},{code:4,text:"4"}]
  departmentRender([],departmentArr)


  function conditionRender(initial,items){
    // items = items.slice(1);
    let dom=document.querySelector("#condition")
    let listDom=dom.querySelector(".list-singleLine")
    let unlimitedDom=dom.querySelector(".unlimited_btn")

    unlimitedControl(unlimitedDom,initial)
    listRender(listDom,items,'condition')
  }
let conditionArr=[{code:1,text:"123"},{code:2,text:"2"},{code:3,text:"3"},{code:4,text:"4"}]
conditionRender([],conditionArr)





</script>
<!-- <script>
  // let Header=new HEADER()
  let searchObj = {
    keyword: "",
    city: "臺北市",
    district: [],
    department: [],
    condition: [],
  };

  // manager.selectCity(searchObj.city);
  const initCityUIRender = () => {
    let dom = document.querySelector(".major-content-list.city-container");
    let str = "";
    const entries = Object.entries(manager.data);
    for (let i = 0; i < entries.length; i++) {
      const zone = entries[i];
      const city = Object.keys(zone[1]);
      str += ` <div class="list-one-line">
                <div class="list-item zone">${zone[0]}</div>
                 ${city
                   .map(
                     (item, index) =>
                       `<div data-id="${item}" onclick="cityChange('${
                         zone[0]
                       }','${item}')" class="list-item
                        city ${searchObj.city === item ? "active" : ""}
                       ">${item}</div>`
                   )
                   .join("")}
                </div>`;
    }

    dom.innerHTML = str;
  };
  initCityUIRender();

  const cityChange = (zone, city) => {
    let target = event.target; //自己
    manager.selectArea(zone);
    manager.selectCity(city);
    activeCssChange("single", target);
  };

  function initDistrictUIRender(initial, items) {
    items = items.slice(1);
    console.log(items, "itemsss");
    let districtDom = document.querySelector("#district-container");

    let district = new RESERVATION_SEARCH(districtDom, items);
  }
  // function initDepartmentUIRender(params) {
  //   let data = [
  //     { code: "1", text: "Ｘ光" },
  //     { code: "2", text: "測試" },
  //   ];
  //   let dom = document.querySelector(".department-container .list-one-line");
  //   let str = "";
  //   data.forEach((item) => {
  //     str += ` <div data-id="${item.code}" class="list-item department " onclick="optionSelect('department')">${item.text}</div>`;
  //   });
  //   dom.innerHTML = str;
  // }
  // initDepartmentUIRender();

  // function initConditionUIRender(params) {
  //   let data = [
  //     { code: "1", text: "Ｘ光" },
  //     { code: "2", text: "測試" },
  //   ];
  //   let dom = document.querySelector(".condition-container .list-one-line");
  //   let str = "";
  //   data.forEach((item) => {
  //     str += ` <div data-id="${item.code}" class="list-item condition " onclick="optionSelect('condition')">${item.text}</div>`;
  //   });
  //   dom.innerHTML = str;
  // }
  // initConditionUIRender();

  let data = [
    { code: "1", text: "Ｘ光" },
    { code: "2", text: "測試" },
  ];
  let conditionDom = document.querySelector("#condition-container");

  let condition = new RESERVATION_SEARCH(conditionDom, data);

  let departmentDom = document.querySelector("#department-container");

  let department = new RESERVATION_SEARCH(departmentDom, data);

  // let department= new RESERVATION_SEARCH(dom,data);
  // 預設進來

  // 撈科別ＡＰＩ 得到陣列
  // 預設不限會亮
  // initDepartmentUIRender(array)

  // 撈條件ＡＰＩ 得到陣列
  // 預設不限會亮
  // initConditionUIRender(array)

  // 到這邊應該是畫面沒有任何選取 ＵＩ炫染完成

  // 撈最重要的ＡＰＩ 得到 他目前選擇的全部
  // 預設是台北市不分區
  // manager.selectCity(searchObj.city); 台北市帶進去 得到區域的列表
  // initDistrictUIRender（）

  // 台北市會active 然後不限會active

  // 需特別注意：{
  //   換城市 區域的active就會變不限
  // }

  // 最後會形成一個 一個obj
  // post API取得結果

  // 有兩種狀況
  // 如果他是搜尋進來 會直接走post 然後畫面停在搜尋結果
  // 跟他是預約掛號點進來 全部都是空值 就不要移動

  function activeCssChange(type, target) {
    if (type === "single") {
      if (target.classList.contains("active")) {
        return;
      }
      let oldDom = document.querySelector(
        ".city-container .list-one-line .active"
      );
      oldDom.classList.remove("active");
      target.classList.add("active");
      return;
    }
    if (type === "many") {
      target.classList.toggle("active");
    }
  }
  // function optionSelect(type) {
  //   let target = event.target; //自己
  //   let dataID = target.getAttribute("data-id");
  //   let value = target.textContent;

  //   let targetObj = {
  //     id: dataID,
  //     value,
  //   };

  //   activeCssChange("many", target);
  //   let searchObj_data = searchObj[type];
  //   dataArrHanglder(targetObj, searchObj_data, type);
  // }
  // function dataArrHanglder(targetObj, ARR, type) {
  //   let isExist = ARR.findIndex((item) => item.id === targetObj.id);

  //   if (isExist !== -1) {
  //     ARR.splice(isExist, 1);
  //   } else {
  //     ARR.push(targetObj);
  //   }
  //   notLimitedControl(ARR, type);
  // }
  // function notLimitedControl(arr, type) {
  //   let length = arr.length || null;
  //   let dom = document.querySelector(
  //     `.major-content-title .notLimited.${type}`
  //   );
  //   if (!length) {
  //     dom.classList.add("active");
  //   } else {
  //     dom.classList.remove("active");
  //   }
  // }
</script>

<script>
  // import INPUT from '/js/class/INPUT.js';
  const input = new INPUT(
    document.querySelector(".major-content-title input.keyword"),
    document.querySelector(".major-content-title .cancelIcon")
  );

  const pagination = new PAGINATION(
    document.querySelector(".pagination-container ul.page"),
    7
  );
</script> -->

<script>
  // 搜尋結果那個ＡＰＩ得到的節果 會是array
  // 預設一定是第一頁

  // 搜尋出去會分兩種 想寫在同一支？
  // 有合作{
  //   診所基本資料
  //   診所班表
  //   立即預約（導頁）
  //   現場看診進度 （導頁）
  //   注意事項
  //   門診公告
  //   我們自己的ＡＤ
  // }

  // 沒合作{
  //   診所基本資料
  //   診所班表
  //   回上一頁btn
  //   我們自己的ＡＤ
  // }

  // 立即預約{
  //   進入step 三部曲
  //   1
  //   醫師列表
  //   約診日期
  //   約診時段

  //   2
  //   剛剛選取的預約資料 放上來
  //   填寫聯絡資訊

  //   3
  //   全部完成
  //   查詢（導頁）

  // }
</script>
