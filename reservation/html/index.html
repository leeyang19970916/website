<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>預約掛號首頁index</title>
    <link rel="stylesheet" href="/common/sass/common.css" />
    <link rel="stylesheet" href="/reservation/scss/reservation.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body>
    <div id="container-bg" class="border p-0">
      <header class="header"></header>
      <div id="index-search-container">
        <section class="ad-loop">ad廣告輪播</section>
        <div class="majorTitle">預約掛號</div>
        <div class="card">
          <div class="cardItem">
            <div class="minTitle">搜尋關鍵字</div>
            <div class="input-container input_keyWordValue">
              <!-- <input
                type="text "
                placeholder="關鍵字搜尋..."
                class="form-control keyword"
              />
              <i class="fa-solid fa-xmark cancelIcon"></i> -->
            </div>
          </div>
          <div class="cardItem">
            <div class="minTitle borderBottom">選擇城市</div>
            <div class="cardItem-container city-container">
              <div class="list-singleLine">
                <div class="listItem listItem-zone">北部</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city active">基隆市</div>
              </div>
              <div class="list-singleLine">
                <div class="listItem listItem-zone">北部</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city active">基隆市</div>
              </div>
            </div>
          </div>
          <div id="district" class="cardItem">
            <div class="minTitle borderBottom">
              選擇區域(可複選)
              <div
                class="unlimited_btn district active"
                onclick="optionSelect('district','reset')"
              >
                不限
              </div>
            </div>
            <div class="cardItem-container district-container">
              <div class="list-singleLine">
                <div class="listItem listItem-zone">北部</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city active">基隆市</div>
              </div>
            </div>
          </div>

          <div id="department" class="cardItem">
            <div class="minTitle borderBottom">
              選擇科別(可複選)
              <div
                class="unlimited_btn department active"
                onclick="optionSelect('department','reset')"
              >
                不限
              </div>
            </div>
            <div class="cardItem-container department-container">
              <div class="list-singleLine">
                <div class="listItem listItem-zone">北部</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city active">基隆市</div>
              </div>
            </div>
          </div>

          <div id="condition" class="cardItem">
            <div class="minTitle borderBottom">
              更多條件(可複選)
              <div
                class="unlimited_btn condition active"
                onclick="optionSelect('condition','reset')"
              >
                不限
              </div>
            </div>
            <div class="cardItem-container condition-container">
              <div class="list-singleLine">
                <div class="listItem listItem-zone">北部</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city">基隆市</div>
                <div class="listItem listItem-city active">基隆市</div>
              </div>
            </div>
          </div>
          <button class="search_btn">搜尋</button>
        </div>
        <section class="searchResult">
          <div class="majorTitle">搜尋結果</div>
          <div class="card">
            <div class="total">共38間診所</div>
            <div class="clinicList">
            </div>
            <section id="pagination" class="pagination">
              <ul class="page"></ul>
            </section>
          </div>
        </section>
      </div>

      <footer></footer>
    </div>
  </body>
</html>
<style>
</style>
<!-- <script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script> -->
<!-- <script src="../../js/innerHeight.js"></script> -->
<!-- <script src="../../js/cityZoneSelect.js"></script> -->
<!-- <script src="../../component/Header.js"></script> -->
<!-- <script src="../../component/Navbar.js"></script>
<script src="../../component/Carousel.js"></script>
<script src="../../component/HashTagContainer.js"></script>
<script src="../../component/Title-line.js"></script> -->
<!-- <script src="../../component/Footer.js"></script> -->

<!-- <script type="module" src="/js/UI_render.js"></script>
<script src="../../AreaManager.js"></script>
<script src="/js/class/INPUT.js"></script>
<script src="/js/class/PAGINATION.js"></script>
<script src="/js/class/RESERVATION_SEARCH.js"></script> -->

<script type="module" src="/common/js/Common_UI_Render.js"></script>
<!-- <script src="/common/js/Header.js"></script> -->
<script src="/common/js/INPUT.js"></script>
<script src="/reservation/js/class/AREAMANAGER.js"></script>
<script src="/reservation/js/class/PAGINATION.js"></script>
<script src="/reservation/js/class/RESERVATIONFILTER.js"></script>
<script src="/common/js/Header.js">
  
  // HEADER.js
  let h_page = new HEADER("預約掛號");
</script>
<script>
  // page

  let reservationFilter = new RESERVATIONFILTER();
</script>
<script>
  let dataOBJ = {
    keyword: "",
    city: "臺北市",
    district: [],
    department: [],
    condition: [],
  };
  // areaManager
  let manager = new AREAMANAGER();
  manager
    .onAreaChange((initial, items) => {})
    .onCityChange((initial, items) => {})
    .onDistrictChange((initial, items) => {
      districtUIRender(initial, items);
    })
    .start();

  const initCityUIRender = () => {
    let dom = document.querySelector(".cardItem-container.city-container");
    let str = "";
    // console.log(reservationFilter.city,"reservationFilter")
    const entries = Object.entries(manager.data);
    for (let i = 0; i < entries.length; i++) {
      const zone = entries[i];
      const city = Object.keys(zone[1]);
      str += ` <div class="list-singleLine">
                <div class="listItem listItem-zone">${zone[0]}</div>
                 ${city
                   .map(
                     (item, index) =>
                       `<div data-id="${item}" onclick="cityChange('${
                         zone[0]
                       }','${item}')" 
                       class=" listItem listItem-city ${
                         reservationFilter.city === item ? "active" : ""
                       }">${item}</div>`
                   )
                   .join("")}
                </div>`;
    }
    // ${searchObj.city === item ? "active" : ""}
    dom.innerHTML = str;
  };
  initCityUIRender();

  const cityChange = (zone, city) => {
    let target = event.target; //自己
    manager.selectArea(zone);
    manager.selectCity(city);
    let oldDom = document.querySelector(
      ".cardItem-container.city-container .active"
    );
    if (oldDom === target) {
      return;
    }
    oldDom.classList.remove("active");
    target.classList.add("active");
    reservationFilter.onCityChange(city);
  };
  function districtUIRender(initial, items) {
    items = items.slice(1);
    let dom = document.querySelector("#district");
    let listDom = dom.querySelector(".list-singleLine");
    let unlimitedDom = dom.querySelector(".unlimited_btn");

    unlimitedControl(unlimitedDom, initial);
    listRender(listDom, items, "district");
  }
  function listRender(dom, arr, type) {
    console.log(type, "tpye");
    let str = "";
    for (let i = 0; i < arr.length; i++) {
      const e = arr[i];
      str += `<div data-id=${e.code} class="listItem listItem-district" onClick=optionSelect('${type}')>${e.text}</div>`;
    }
    dom.innerHTML = str;
  }
  function unlimitedControl(dom, initial) {
    if (initial === "不分區" || initial === []) {
      dom.classList.add("active");
      return;
    }
    dom.classList.remove(".active");
  }
  function optionSelect(params, state = null) {
    let e = event.target;
    if (state === "reset") {
      reservationFilter.onReset(params);
      return;
    }
    let obj = {
      id: e.getAttribute("data-id"),
      text: e.innerHTML,
    };
    // console.log(obj,"event")
    if (params === "district") {
      reservationFilter.onDistrictChange(obj, params);
    } else if (params === "department") {
      reservationFilter.onDepartmentChange(obj, params);
    } else {
      // condition
      reservationFilter.onConditionChange(obj, params);
    }
  }
  function departmentRender(initial, items) {
    // items = items.slice(1);
    let dom = document.querySelector("#department");
    let listDom = dom.querySelector(".list-singleLine");
    let unlimitedDom = dom.querySelector(".unlimited_btn");

    unlimitedControl(unlimitedDom, initial);
    listRender(listDom, items, "department");
  }
  let departmentArr = [
    { code: 1, text: "家醫科" },
    { code: 2, text: "內科" },
    { code: 3, text: "中醫科" },
    { code: 4, text: "骨科" },
  ];
  departmentRender([], departmentArr);

  function conditionRender(initial, items) {
    // items = items.slice(1);
    let dom = document.querySelector("#condition");
    let listDom = dom.querySelector(".list-singleLine");
    let unlimitedDom = dom.querySelector(".unlimited_btn");

    unlimitedControl(unlimitedDom, initial);
    listRender(listDom, items, "condition");
  }
  let conditionArr = [
    { code: 1, text: "週六看診" },
    { code: 2, text: "周日看診" },
    { code: 3, text: "X光" },
    { code: 4, text: "動態心電圖" },
  ];
  conditionRender([], conditionArr);
</script>

<script>
  // input
  // let inputContainer=document.querySelector(".input_keyWordValue")
  // let wqw=inputContainer.querySelector(".keyword")
  // wqw.addEventListener("change",keywordChange)
  // console.log(wqw,"qdwq")
  // function keywordChange(params) {
  //   console.log(inputContainer,"inputContainer","qwqwefqefew",params)
  // }
</script>

<script>
  // click 搜尋 得到data renderUI
  let data = {
    total: 100,
    page: 20,
    nowPage: 1,
    clinicList: [
      {
        clinicName: "丁文內科診所",
        clinicID: "w95135",
        address: "新北市蘆洲區長安街23號",
        department: ["家醫科", "婦產科"],
        tel: "02-54156651265",
      },
      {
        clinicName: "丁文內科診所",
        clinicID: "w95135",
        address: "新北市蘆洲區長安街23號",
        tel: "02-54156651265",
        department: ["家醫科", "婦產科"],
      },
    ],
  };
  let resultDom = document.querySelector(".searchResult");
  function listUIRender() {
    let totalDom = resultDom.querySelector(".total");
    totalDom.innerHTML = `共${data.total}間診所`;
    let clinicListDOM = resultDom.querySelector(".clinicList");
    let str = "";
    for (let i = 0; i < data.clinicList.length; i++) {
      const e = data.clinicList[i];
      str += `<div class="clinicItem">
          <div class="departmentList">
            ${e.department.map(d=>`<div class="departmentItem department">${d}</div>`).join("")}
            <div class="departmentItem department">家醫科</div>
            <div class="departmentItem department">家醫科</div>
            <div class="departmentItem department">家醫科</div>
          </div>
          <div class="inform">
            <div class="informItem name">${e.clinicName}</div>
            <div class="informItem tel">${e.tel}</div>
            <div class="informItem address">${e.address}</div>
            <div class="informItem btn btn-detail" onclick='redirect(${i})'>詳細內容</div>
          </div>
        </div>
      `;
    }
    clinicListDOM.innerHTML=str
  }
  listUIRender();

  let page = new PAGINATION(data.page);

  function redirect(i) {
    console.log("經過了嗎")
    return
    if (i===1) {
      window.location.href='/reservation/html/clinic_website_simple.html'

    }else{
      window.location.href='/reservation/html/formal/clinic_website_formal.html'

    }
  }
  let inputDom=document.querySelector(".input_keyWordValue")
  let www=new INPUT(inputDom)
</script>


<script>
  document.addEventListener('scroll',function(e){
    // console.log(e,this)
    if (window.innerHeight + window.scrollY >= document.body.scrollHeight) {
    console.log('已經滑到最下方','只要經過一次');
    // 這時觸發fontawesome 轉轉轉 
    // 然後撈API往下展示
  }
  })
</script>